<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DE2 project: FM radio receiver with digital tuning</title>
<link rel="icon" href="VUT_favicon.jpg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="FEKT_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">DE2 project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__r_e_a_d_m_e.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">FM radio receiver with digital tuning </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Team members</h1>
<ul>
<li>Tadeáš Fojtách (responsible for OLED display configuration)</li>
<li>David Haisman (responsible for control peripherals)</li>
<li>Karel Matoušek (responsible for radio module configuration)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Abstract</h1>
<p>This project deals with controlling the radio module SI4703 using the ATmega328 microcontroller and the C programming language. Its goal is to provide the user with a predefined list of stations typically receivable in Brno and allow them to receive the FM broadcast. Two rotary encoders are used, one for radio tuning and one for the volume control. Small OLED display is used to control the radio (volume and frequency) and show the name of current channel.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Connection of the project</h1>
<p><img src="./assets/project_scheme.png" alt="image" width="800" class="inline"/></p>
<p><em>Project scheme</em></p>
<p><img src="./assets/device_connection.jpg" alt="image" width="800" class="inline"/></p>
<p><em>Real project connection</em></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Usage manual</h1>
<p>As mentioned before, this device uses two rotary encoders. The one used for frequency tuning has two modes, between which the user can switch by pushing the button on it. One mode allows the user to tune the frequency with a 100 kHz step, and the other one is used for going through the predefined station frequencies. The second rotary encoder is used for volume control.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Documentation</h1>
<p><a href="./docs/html">Documentation</a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Demonstrative video</h1>
<p><a href="https://www.youtube.com/watch?v=yhS_RZJiaSA"><img src="https://img.youtube.com/vi/yhS_RZJiaSA/0.jpg" alt="Video title" class="inline"/></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Main program diagram</h1>
<p><img src="./assets/main_program_diagram.png" alt="Main program diagram" width="500" class="inline"/></p>
<p><em>Main program diagram</em></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Used hardware</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Arduino UNO</h2>
<p>Project uses Arduino Uno clone utiliting ATmega328p as a microcontroller.</p>
<p><img src="./assets/atmega328p_pinout.png" alt="ATmega328p pinout" width="500" class="inline"/></p>
<p><em>Arduino Uno - ATmega328p pinout</em></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
SI4703</h2>
<p>SI4703 is a radio module used for receiving FM radio broadcast. It uses 3.3V logic and I2C to communicate with the controller. To activate the receiver, some device, that can be used as antenna (for example headphones), must be plugged in to the connector. This device is also used for reproducing the decoded received radio signal. <img src="./assets/radio_logic_diagram.png" alt="Display logic diagram" height="400" class="inline"/> <br  />
</p>
<p><em>Radio logic diagram</em></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
SSD1306</h2>
<p>The SSD1306 is an OLED display used to show the volume and frequency selected by the user, as well as the station name and the RSSI (Received Signal Strength Indicator) provided by the SI4703 FM radio module. It communicates over the I²C interface, and the libraries used originate from the DE2 course materials. The display updates its contents using a cursor-based drawing system, where text is written character-by-character into the display buffer before being sent to the OLED. <br  />
 <img src="https://github.com/user-attachments/assets/2a181d5e-2865-45e9-8024-23a666c99a78" alt="Display logic diagram" width="500" class="inline"/> <br  />
</p>
<p><em>Display logic diagram</em></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Rotary encoder</h2>
<p>This project utilizes two modules with quadrature encoder. Each of this module contains pull-up resistors for <em>CLK</em> and <em>DT</em> pins.</p>
<p><b>Encoder usage:</b></p><ul>
<li>Encoder on the right side is used to set volume of the radio. Value set by this encoder is software limited between values 0 and 15.</li>
<li>Encoder on the left side has two settings. To toggle between each settings, button on the modul shaft itself is utilized.<ul>
<li><em>Radio_index</em> setting (mode=0) is used to navigate in array of predefined frequencies commonly found in Brno"
  - &lt;em&gt;Frequency&lt;/em&gt; setting (mode=1) sets an exact frequency of the radio. Range of the encoder is set between values 875 and 1080 (corresponding to 87.5 MHz - 108.0 MHz using fixed point numbers)

&lt;img width="600" alt="Encoder usage" src="./assets/encoder_usage.png"/&gt; <br  />
</li>
</ul>
</li>
</ul>
<p><em>Encoder usage</em></p>
<p><b>Encoder program</b></p>
<p>Software uses pin change interrupt to capture edge of the signal from <em>CLK</em> pin. To ensure fast ISR, only states of <em>CLK</em> a <em>DT</em> pins are read and change flag is set. This code is encapsulated inside inline function to further increase the execution speed.</p>
<p>Actual increment or decrement is evaluated inside a function executed from main loop. If <em>change_flag</em> is set and bouncing is not issued, increment is evaluated from pin states set in ISR. If previous state of <em>CLK</em> was <em>0</em> and current is <em>1</em> rising edge has been detected. In case when current state of <em>DT</em> is <em>0</em> after a rising edge of <em>CLK</em>, CCW rotation of the encoder is detected. Code is similar for other 3 possible combination.</p>
<p><img src="./assets/encoder_program_diagram.png" alt="Encoder usage" width="400" class="inline"/> <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Used third-party codes and libraries</h1>
<ul>
<li><a href="https://github.com/panosss/AVR-Si4703-V1.5">AVR-Si4703-V1.5</a> by panosss</li>
<li><a href="https://github.com/tomas-fryza/avr-labs">avr-labs</a> by tomas-fryza (MIT License)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
License</h1>
<p>This project is distributed under the MIT License. See the <a href="./LICENSE">LICENSE</a> file for full license text.</p>
<p>Parts of the project include third-party libraries covered by their respective licenses:</p><ul>
<li>AVR-GCC teaching libraries by Tomáš Fryza — MIT License © 2019–2024</li>
<li>SI4703 library by KiKi</li>
<li>oled library by Michael Köhler — Copyright 2016 Skie-Systems</li>
<li>font library by Michael Köhler — Copyright 2018 Skie-Systems</li>
</ul>
<p>All third-party components retain their original licenses and copyrights. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
